<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta name="ad.size" content="width=100%,height=100%">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="normalize.css">
	<link rel="stylesheet" href="main.css" />
	<title>megafon</title>
</head>
<body onload="init()">

	<div id="html_banner">
		<a class="html_banner_link" href="%link1%" target="_blank">
			<div class="html_banner_dinam"></div>
			<div class="html_banner_bg"></div>
			<div class="html_banner_circle html_banner_circle__1"></div>
			<div class="html_banner_circle html_banner_circle__2"></div>
			<div class="html_banner_title_1"></div>
			<div class="html_banner_title_2"></div>
			<div class="html_banner_btn"></div>
			<div class="html_banner_bottom"></div>
			<span class="html_banner_uma" id="uma"></span>
		</a>
		<!-- <input type="text" id="slide" disabled placeholder="#">
		<input type="text" id="gamma" disabled placeholder="gamma"> -->
	</div>

	<script type="text/javascript" src="prefixfree.min.js"></script>
	<script type="text/javascript" src="gyronorm.complete.min.js"></script>

	<script type="text/javascript">

	var gn, count = 35, current = 18, gamma = 0, step = 0, prev, timer;
	var currentInput = document.getElementById('slide'), gammaInput = document.getElementById('gamma');
	var uma = document.getElementById('gamma');

	var args = {
		frequency: 300
	};

	currentInput.value = current;

	function init() {

	  gn = new GyroNorm();

	  gn.init(args).then(function() {
	    var isAvailable = gn.isAvailable();
	    gn.start(gnCallBack);
	  }).catch(function(e){
	    console.log(e);
	  });

	}

	function gnCallBack(data) {
	  gamma = data.do.gamma;
	  gammaInput.value = gamma;
	  if(gamma > 10) {
	    step = 1;
	    slider();
	  } else if(gamma < -10) {
	    step = -1;
	    slider();
	  } else {
	    step = 0;
	    slider();
	  }
	}

	function slider() {
	  if(prev !== step) {
			prev = step;
	    clearInterval(timer);
			timer = setInterval(function() {
				if(current <= 1 || current >= count) clearInterval(timer);
		    current = current + step;
		    currentInput.value = current;
				uma.style.backgroundImage = "url('img/sequence/sequence_" + current + ".png')";
		  }, 150);
		  console.log('timer', timer);
		}
	}

	</script>

</body>
</html>
